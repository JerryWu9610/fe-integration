# 技术架构

- 使用 pnpm monorepo 进行依赖管理，packages/api 下放置 API 服务

## API 服务

以 HTTP API 接口的形式提供服务，主要负责集成流程的执行、配置信息的获取

- 使用 Nest.js 作为基础框架
- 需要集成参数校验功能
- 接口响应都有统一的格式: `{ code: string; message: string; data?: any; }`
- 接口均以 /api 开头，都使用 POST 作为 HTTP Method，不需要遵循 restful API
- 使用 JSON 文件的形式存储易变的配置，存储在项目下的 /config 文件夹
- 使用 sqlite 存储流程执行数据，数据库文件存储在项目下的 /data 文件夹
- 项目下提供一个 env.yaml 与 env.example.yaml，用于运行相关的环境变量，以一个 ConfigService 进行读取

配置信息包含:

- 业务仓库: 各个产线的前端业务代码相关信息，包括 gitlab 信息、业务包存储的制品仓库信息（包括仓库与包名）
- 前端集成仓库: 各个产线的前端集成仓库相关信息，包括 gitlab 信息、集成包的制品仓库信息（包括仓库与包名）
- 整包集成仓库: 各个产线的整包集成仓库相关信息，包括 gitlab 信息
- 操作步骤定义: 操作步骤的注册，包括名称与所需的参数信息，如 "更新前端集成信息"、"前端集成打包"、"更新整包集成信息"，对应代码中的整块执行逻辑
- 流程定义: 由多个操作步骤组成，以语义化的名称供使用，避免外部直接使用操作步骤，同时便于后续不同版本的流程进行拓展
- 产品类型: 产品信息，关联业务仓库、前端集成仓库、整包集成仓库

流程执行数据包括:

- 定时执行的配置信息
- 流程执行记录: 执行时间、执行人、执行状态、日志
